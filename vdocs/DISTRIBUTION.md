# Distribution Pipeline for Ronin

**Created:** 2025-12-20  
**Tauri Version:** v2.9.5  
**Target Platform:** Linux (primary)

---

## Overview

This document outlines the build and distribution process for Ronin on Linux. It covers generating `.deb`, `.AppImage`, and `Flatpak` packages, along with automation strategies for releases.

---

## Build Formats

### 1. Debian Package (`.deb`)

**Description:** Compressed archive for Debian-based systems (Ubuntu, Mint, etc.). Relies on system libraries.

**Pros:**
- Smaller file size
- Native package management integration
- Easy to install with `apt` or `dpkg`

**Cons:**
- Requires system dependencies
- Less portable across distros

**Generate:**
```bash
npm run tauri build
```

**Output:** `src-tauri/target/release/bundle/deb/ronin_0.1.0_amd64.deb`

**Installation:**
```bash
sudo dpkg -i ronin_0.1.0_amd64.deb
sudo apt-get install -f  # Fix dependencies if needed
```

**System Dependencies (auto-included):**
- `libwebkit2gtk-4.1-0`
- `libgtk-3-0`
- `libappindicator3-1` (if system tray used)

---

### 2. AppImage (`.AppImage`)

**Description:** Self-contained executable with all dependencies bundled.

**Pros:**
- Maximum portability
- No installation required
- Run on any Linux distro

**Cons:**
- Larger file size (~50-100 MB)
- No auto-updates without additional setup

**Generate:**
```bash
npm run tauri build
```

**Output:** `src-tauri/target/release/bundle/appimage/ronin_0.1.0_amd64.AppImage`

**Usage:**
```bash
chmod +x ronin_0.1.0_amd64.AppImage
./ronin_0.1.0_amd64.AppImage
```

**Notes:**
- Best option for user-facing releases
- Works without admin privileges
- Recommended for GitHub Releases

---

### 3. Flatpak

**Description:** Universal Linux package format. Not directly generated by Tauri.

**Workflow:**
1. Build `.deb` package
2. Create Flatpak manifest referencing `.deb`
3. Use `flatpak-builder` to generate Flatpak

**Pros:**
- Sandboxed application
- Distribution via Flathub
- Automatic updates

**Cons:**
- More complex build process
- Requires manifest maintenance

**Recommended Approach:** Manual process for Flathub submission after v1.0 release.

---

## Build Commands

### Development Build
```bash
npm run tauri dev
```

### Release Build (All Formats)
```bash
npm run tauri build
```

This generates **both** `.deb` and `.AppImage` in:
- `src-tauri/target/release/bundle/deb/`
- `src-tauri/target/release/bundle/appimage/`

### Build for Specific Target
```bash
# Only .deb
cargo tauri build --bundles deb

# Only AppImage
cargo tauri build --bundles appimage
```

---

## Release Automation

### GitHub Actions Workflow

Create `.github/workflows/release.yml`:

```yaml
name: Release

on:
  push:
    tags:
      - 'v*'  # Trigger on version tags: v0.1.0, v1.0.0, etc.

jobs:
  release:
    name: Build and Release
    runs-on: ubuntu-22.04  # Use LTS for max compatibility
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable
      
      - name: Cache Rust
        uses: actions/cache@v4
        with:
          path: |
            ~/.cargo/bin/
            ~/.cargo/registry/index/
            ~/.cargo/registry/cache/
            ~/.cargo/git/db/
            src-tauri/target/
          key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}
      
      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \\
            libwebkit2gtk-4.1-dev \\
            build-essential \\
            curl \\
            wget \\
            file \\
            libssl-dev \\
            libayatana-appindicator3-dev \\
            librsvg2-dev
      
      - name: Install frontend dependencies
        run: npm ci
      
      - name: Build app
        run: npm run tauri build
      
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            src-tauri/target/release/bundle/deb/ronin_*.deb
            src-tauri/target/release/bundle/appimage/ronin_*.AppImage
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### Manual Release Process

1. **Update version:**
   ```bash
   # In package.json
   "version": "0.2.0"
   
   # In src-tauri/Cargo.toml
   version = "0.2.0"
   
   # In src-tauri/tauri.conf.json
   "version": "0.2.0"
   ```

2. **Commit and tag:**
   ```bash
   git add package.json src-tauri/Cargo.toml src-tauri/tauri.conf.json
   git commit -m "chore: bump version to 0.2.0"
   git tag v0.2.0
   git push origin main --tags
   ```

3. **Wait for GitHub Actions** to build and create release

4. **Download artifacts** from GitHub Releases:
   - `ronin_0.2.0_amd64.deb`
   - `ronin_0.2.0_amd64.AppImage`

---

## Compatibility Notes

### Linux Distribution Compatibility

**Build System Recommendation:** Ubuntu 22.04 LTS

**Why?**
- Maximum `glibc` compatibility
- Binaries built on Ubuntu 22.04 work on newer systems
- Binaries built on Ubuntu 24.04 may fail on older systems

**Supported Distributions:**
- Ubuntu 22.04+ ✅
- Debian 11+ ✅
- Fedora 36+ ✅
- Arch Linux (current) ✅
- Pop!_OS 22.04+ ✅
- Linux Mint 21+ ✅

---

## Future Enhancements

### Post v1.0 Release

1. **Flathub Submission**
   - Create Flatpak manifest
   - Submit to Flathub for distribution
   - Setup auto-update mechanism

2. **Auto-Updater**
   - Implement using `@tauri-apps/plugin-updater`
   - Check for updates on app launch
   - Silent background updates

3. **Snap Package**
   - Alternative to Flatpak
   - Canonical's Snap Store distribution

4. **Code Signing**
   - Sign AppImages for security
   - Establish trust chain

---

## Testing Releases

### Pre-Release Checklist

- [ ] Version bumped in all files
- [ ] Changelog updated
- [ ] All tests passing (`npm test` + `cargo test`)
- [ ] CI/CD pipeline green
- [ ] Manual smoke test on Ubuntu 22.04
- [ ] Manual smoke test on Fedora (if possible)

### Post-Release Verification

```bash
# Test .deb installation
sudo dpkg -i ronin_*.deb
ronin  # Launch app
sudo apt remove ronin

# Test AppImage
chmod +x ronin_*.AppImage
./ronin_*.AppImage
```

---

## Resources

- [Tauri v2 Building Docs](https://v2.tauri.app/develop/calling-rust/)
- [Tauri v2 Bundling Docs](https://v2.tauri.app/reference/config/#bundleconfig-deb)
- [GitHub Actions for Tauri](https://tauri.app/v1/guides/building/linux)
- [AppImage Documentation](https://appimage.org/)

---

**Last Updated:** 2025-12-20  
**Status:** Foundation complete, ready for v1.0 release automation
